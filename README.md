# 帮助文档

这是一个用于辅助安科(あんこスレ)的创作的vscode扩展。

- QQ交流群群号：722865990，使用上遇到bug、想要讨论想要加上去的功能或者单纯进群凑个热闹都是可以的
- [本扩展在NGA论坛的交流帖](https://nga.178.com/read.php?tid=34766889)

## 「安科」是什么？

以下介绍摘自「[萌娘百科-安科](https://zh.moegirl.org.cn/%E5%AE%89%E7%A7%91)」

> [安科](https://zh.moegirl.org.cn/%E5%AE%89%E7%A7%91)（日语：[あんこスレ](https://yaruo.fandom.com/wiki/%E3%81%82%E3%82%93%E3%81%93%E3%82%B9%E3%83%AC)）是起源于[AA漫画](https://zh.moegirl.org.cn/AA%E6%BC%AB%E7%94%BB)的一种剧情推进形式。
> 
> 创作者自己设定一些剧情走向（通常为10个选项），再通过随机点数决定进一步的剧情

目前国内的安科创作平台（仅列出了我知道的几个，不分先后）：

- [NGA论坛-二次元跑团综合版块](https://nga.178.com/thread.php?fid=784)
- [百度贴吧-安科吧](https://tieba.baidu.com/f?kw=%E5%AE%89%E7%A7%91)
- [骨碌碌文字世界](https://www.gululuworld.com/)
- [纯美苹果园](http://bbs.goddessfantasy.net/bbs)
- [寝不足创作](https://www.qinbuzu.com/)


## 功能

### 安科图片资源管理器

安科里经常会用到图片，有的是只用一次的背景图，有的是在每句对话前添加的角色立绘差分图。

一些在NGA论坛创作安科的作者，采用的方式是先在同一层楼上传完需要用到的所有角色差分，将上传后得到的图片链接保存下来，在发布正文内容时就不需要重复上传图片附件了。这个功能就是为此设计的。

![图片资源管理器示例](images/图片资源管理示例1.png)

图片链接数据存储在一个数据文件当中，因为不需要用户知道其内部结构，其结构描述就略去。

安科图片资源管理器里的结点呈现树状结构，结点分为文件夹和图片两种。文件夹可以无限嵌套。

图片结点可以存储网络图片的链接，鼠标移动到图片结点上可以预览该图片，点击结点上的图标可以复制图片纯链接、复制图片的论坛代码（形似`[img]你的图片链接[/img]`）以及删除。

可以以角色名为文件夹名，立绘差分名为图片结点名，例如：

- 博丽灵梦
  - 微笑
  - 惊讶
- 魔理沙
  - 默认
  - 疑惑

顶部按钮的功能分别如下：

- 刷新：发现数据变化但树状视图没有变化时可以刷一刷
- 新建文件夹
- 新建图片结点：链接支持绝对地址、NGA附件相对地址（./mon_xxxx/xxxx.png）、带img标签的NGA附件相对地址（[img]./mon_xxxx/xxxx.png[/img]）
- 选择数据文件：修改所使用的数据文件，用于切换不同的安科资源数据文件
- 新建数据文件：用于打开文件对话框来选一个保存位置，不需要管数据文件里面的内容（当然，里面的结构也不难理解）

### 骰子与骰点历史记录

在侧边栏的安科资源管理器中，第二个视图是骰点记录，可以点击上面的掷骰图标并输入骰点表达式进行掷骰，如果新建了数据文件或者选择了数据文件，投掷结果将会记录下来，并且可以复制

目前支持的骰点表达式格式：

- 骰子个数d骰子面数：1d100,3d6
- 数字加减：1d80+20,1d100-30
- 组合运算：3d6+4d9

### 一键排版

在txt文件或者markdown文件中，可以在右键菜单中找到“安科助手：用论坛代码排版”的菜单项。

点击这个菜单项，会出现一些排版的选项（目前只有一个啦，后面会慢慢增加）

可以在设置中选择一键排版功能是将排版好的内容就地替换还是写入新建文件

| 保存方式     | 说明                                                                               |
| ------------ | ---------------------------------------------------------------------------------- |
| 就地替换     | 将在原文件上修改，侧边栏的「资源管理器」的「时间线」视图能找到自动保存的上一个版本 |
| 写入新建文件 | 会在当前文件旁边生成一个新的文件，并打开差异对比窗口对比前后差别                   |

---


#### 1、展示角色头像的对话排版

排版代码内容来自[[交流] [排版艺术C-]一种支持展示角色头像的对话排版方案](https://nga.178.com/read.php?tid=27497252)。

可以将形似`【可有可无的角色头衔】角色名.差分名：中文冒号后是单行角色发言内容`的行转换为对应的带有头像的形式。

如果想要配**头像**，则在图片管理器建立一个名为“角色”的文件夹，里面是以角色名命名的图片结点或者以角色名命名的文件夹，这是用于给角色配头像的，如果某个角色没有对应的图片，那么就只会加引用框而不配头像。

举个例子，如果图片管理器是下面这样：

- 角色
  - 角色1
  - 角色2
    - 差分1
    - 差分2

那么以下文本的处理就会是括号内说的那样

```
角色1：团长！车已经准备好了！
角色2：哦！那么我走了！
角色3：好，路上小心哦。（没有头像，因为没有检测到角色3）
角色1：感觉真安静啊，街上也没有加拉尔霍恩的人，和总部差别真大啊。（头像使用“角色1”图片）
角色2：啊，可能是他们把火星的战力都调到那里去了。（头像使用“差分1”图片，因为没有指定图片时默认使用第一个差分）
角色1.差分1：不过这也和我们没关系了。（没有头像，因为角色1没有差分，只有默认头像）
角色2.差分3：你心情很愉快啊。（没有头像，因为角色2没有“差分3”图片）
角色1：那是当然的了！大家也有救了，塔卡基又那么努力，我也要加油了！
角色2：啊。（内心自白）没错，我们至今为止所做的一切，并不是全部徒劳的。今后也是，只要我们不停下脚步，道路就会不断延伸。
```

**角色头衔**（用中文中括号框住的部分）是类似于QQ聊天群里面的那种头衔，比如【群主】、【管理员】之类的，之所以做出来是因为我自己用得到。

它可有可无，在最后结果中会保留，但不会用于识别。方括号中英文都可以，但**冒号需要是中文冒号**，这是为了避免误伤一般使用英文冒号的骰子文本。

**差分名**的格式可以在设置中修改，可以是以下两种形式：

```
角色名.差分名：中英文句号都可以
角色名（差分名）：中英文圆括号都可以
```

可以设置在排版后是否保留差分名。

#### 2、markdown转NGA代码

除了常见的粗体斜体下划线链接图片等转换，还支持\<details\>标签转化成[collapse]标签，在里面用\<summary\>标签来指定[collapse]标签的概述

#### 3、给所有骰点表达式加粗

转换前：

```
前情提要：角色1叫上角色2到车里，两人在走廊上边走边聊，即将到达门口。

镜头在门口街道处从上往下移动，画面下方出现提示“来週は夕方5時00分からお送りします”

角色2今天的运气（越大越好）：D100=1
进行幸运检定：D100=100/1 大失败！（coc检定数值越大越失败）

帖内安价：
1.不知道哪里来的黑色高级轿车（车祸吗？）
……（省略中间选项）
9.走在街上突然被暗杀（？）
10.这个安价前面的全部安价选项缝合起来（不要啊！）
ROLL : 1d10=d10(10)=10

一辆黑色高级车驶来急刹并打开车门，在车边等待两人的同伴瞬间中了一枪倒在一旁。

角色2的反应（越大越能做出正确行动，安价选项-20）：d100-20=21-20=1

角色2没有躲进旁边的掩体，而是就地抱着角色1转身蹲下来挨子弹。
角色1：团长，你在干什么啊，团长！
角色2：呃呃啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊！！！（拔出手枪向背后射击）

三名暗杀者是否中弹（1中2不中）：3D2=1+2+2=5

见队友被击中的暗杀者驾车逃离。
```

转换后：

```
前情提要：角色1叫上角色2到车里，两人在走廊上边走边聊，即将到达门口。

镜头在门口街道处从上往下移动，画面下方出现提示“来週は夕方5時00分からお送りします”

角色2今天的运气（越大越好）：[b]D100=1[/b]
进行幸运检定：[b]D100=100/1[/b] 大失败！（coc检定数值越大越失败）

帖内安价：
1.不知道哪里来的黑色高级轿车（车祸吗？）
……（省略中间选项）
9.走在街上突然被暗杀（？）
10.这个安价前面的全部安价选项缝合起来（不要啊！）
[b]ROLL : 1d10=d10(10)=10[/b]

一辆黑色高级车驶来急刹并打开车门，在车边等待两人的同伴瞬间中了一枪倒在一旁。

角色2的反应（越大越能做出正确行动，安价选项-20）：[b]d100-20=21-20=1[/b]

角色2没有躲进旁边的掩体，而是就地抱着角色1转身蹲下来挨子弹。
角色1：团长，你在干什么啊，团长！
角色2：呃呃啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊！！！（拔出手枪向背后射击）

三名暗杀者是否中弹（1中2不中）：[b]3D2=1+2+2=5[/b]

见队友被击中的暗杀者驾车逃离。

```


## 设置

本扩展有以下设置项，可以用快捷键`Ctrl+逗号`或者点击左下角齿轮图标找到设置面板，在设置面板中找到本扩展的设置项

- `ankosure-assistant.imagesDataPath`: 存放图片链接数据的json文件的路径，需要包含文件名。例如`F:/images.json`。现在可以通过图片资源管理器的按钮打开文件浏览器来设置了，基本不需要手动修改这个设置
- `ankosure-assistant.diceLogDataPath`: 存放骰点历史数据的json文件的路径，需要包含文件名。例如`F:/diceLog.json`。现在可以通过资源管理器的按钮打开文件浏览器来设置了，基本不需要手动修改这个设置
- `ankosure-assistant.typeset.saveMethod`: 选择是就地替换还是新建文件了，默认是就地替换
- `ankosure-assistant.typeset.sabun.format`: 角色差分的格式。用于识别对话中的角色差分
- `ankosure-assistant.typeset.sabun.action`: 角色差分的处理方式。可以选择

